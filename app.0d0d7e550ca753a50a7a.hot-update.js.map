{"version":3,"sources":["webpack:///./src/containers/App.jsx"],"names":["IDLE","FETCHING_CONTEXT","window","flag","minilog","toFlagNames","flagName","prefix","isArray","flatten","map","isObjectLike","keys","key","App","props","context","error","status","store","fetchContext","setState","cozy","client","fetchJSON","catch","attributes","features","flags","enableFlags","accounts","konnectors","triggers","isFetching","find","collection","includes","fetchStatus","hasError","state","isFetchingContext","isReady","showTimeline","div","contentWrapper","IntentRedirect","StoreRedirection","DemoTimeline","Component","contextTypes","PropTypes","object","withRouter","appEntryPoint"],"mappings":"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","file":"app.0d0d7e550ca753a50a7a.hot-update.js","sourcesContent":["/* global cozy */\nimport React, { Component } from 'react'\nimport PropTypes from 'react-proptypes'\nimport { Route, Switch, Redirect, withRouter } from 'react-router-dom'\nimport isObjectLike from 'lodash/isObjectLike'\nimport isArray from 'lodash/isArray'\nimport keys from 'lodash/keys'\nimport flatten from 'lodash/flatten'\n\nimport flag, { enable as enableFlags } from 'cozy-flags'\nimport minilog from 'minilog'\n\nimport Alerter from 'cozy-ui/react/Alerter'\nimport { Sprite as IconSprite } from 'cozy-ui/react/Icon'\nimport { Main } from 'cozy-ui/react/Layout'\nimport Spinner from 'cozy-ui/react/Spinner'\n\nimport appEntryPoint from 'components/appEntryPoint'\nimport HeroHeader from 'components/HeroHeader'\nimport Failure from 'components/Failure'\nimport Home from 'components/Home'\nimport IntentRedirect from 'components/IntentRedirect'\nimport StoreRedirection from 'components/StoreRedirection'\nimport ConnectionsQueue from 'ducks/connections/components/queue/index'\nimport DemoTimeline from 'assets/images/timeline.png'\n\nconst IDLE = 'idle'\nconst FETCHING_CONTEXT = 'FETCHING_CONTEXT'\n\nwindow.flag = window.flag || flag\nwindow.minilog = minilog\n\n// TODO add this to cozy-flags ?\nexport const toFlagNames = (flagName, prefix = '') => {\n  if (typeof flagName === 'string') return `${prefix}${flagName}`\n  else if (isArray(flagName))\n    return flatten(flagName.map(flagName => toFlagNames(flagName, prefix)))\n  else if (isObjectLike(flagName))\n    return flatten(\n      keys(flagName).map(key => toFlagNames(flagName[key], `${prefix}${key}.`))\n    )\n}\n\nclass App extends Component {\n  state = {\n    error: null,\n    status: IDLE\n  }\n\n  constructor(props, context) {\n    super(props, context)\n    this.store = context.store\n  }\n\n  componentDidMount() {\n    this.fetchContext()\n  }\n\n  async fetchContext() {\n    this.setState({\n      status: FETCHING_CONTEXT\n    })\n\n    const context = await cozy.client\n      .fetchJSON('GET', '/settings/context')\n      .catch(error => {\n        this.setState({\n          error,\n          status: IDLE\n        })\n      })\n\n    if (context && context.attributes && context.attributes.features) {\n      const flags = toFlagNames(context.attributes.features)\n      enableFlags(flags)\n    }\n\n    this.setState({\n      status: IDLE\n    })\n  }\n\n  render() {\n    const { accounts, konnectors, triggers } = this.props\n    const isFetching = [accounts, konnectors, triggers].find(collection =>\n      ['pending', 'loading'].includes(collection.fetchStatus)\n    )\n\n    const hasError = [accounts, konnectors, triggers].find(\n      collection => collection.fetchStatus === 'failed'\n    )\n\n    const { status } = this.state\n    const isFetchingContext = status === FETCHING_CONTEXT\n\n    const isReady = !hasError && !isFetching && !isFetchingContext\n    const showTimeline = flag('home_show_timeline') // used in demo envs\n\n    return (\n      <div className=\"App\">\n        <div\n          className=\"App-MainCol\"\n          ref={\n            isReady\n              ? div => {\n                  this.contentWrapper = div\n                }\n              : null\n          }\n        >\n          <Alerter />\n          <HeroHeader />\n          {hasError && (\n            <Main className=\"main-loader\">\n              <Failure errorType=\"initial\" />\n            </Main>\n          )}\n          {isFetching && (\n            <Main className=\"main-loader\">\n              <Spinner size=\"xxlarge\" />\n            </Main>\n          )}\n          {isReady && (\n            <Switch>\n              <Route path=\"/redirect\" component={IntentRedirect} />\n              <Route\n                path=\"/connected\"\n                render={() => (\n                  <Home base=\"/connected\" wrapper={this.contentWrapper} />\n                )}\n              />\n              <Route exact path=\"/providers\" component={StoreRedirection} />\n              <Route path=\"/providers/:category\" component={StoreRedirection} />\n              <Redirect exact from=\"/\" to=\"/connected\" />\n              <Redirect from=\"*\" to=\"/connected\" />\n            </Switch>\n          )}\n          <ConnectionsQueue />\n          <IconSprite />\n        </div>\n        {showTimeline && (\n          <div className=\"Timeline\">\n            <img src={DemoTimeline} width=\"420px\" />\n          </div>\n        )}\n      </div>\n    )\n  }\n}\n\nApp.contextTypes = {\n  store: PropTypes.object\n}\n\n/*\nwithRouter is necessary here to deal with redux\nhttps://github.com/ReactTraining/react-router/blob/master/packages/react-router/docs/guides/blocked-updates.md\n*/\nexport default withRouter(appEntryPoint(App))\n"],"sourceRoot":""}